"0","#| message: false"
"0","#| warning: false"
"0","#| echo: false"
"0",""
"0",""
"0","###########"
"0","# Preliminar Analysis: Case 1: Split database in train and test subsets"
"0","###########"
"0",""
"0","sample.test <-c(sample(x = 1:nrow(avesFCFL),size = ceiling(nrow(avesFCFL)* 0.3)),which(avesFCFL$Clade.2 ==""Sphenisciformes""))"
"0",""
"0","avesFCFL.test <- avesFCFL[sample.test,]"
"0","avesFCFL.train <- avesFCFL[-sample(x = 1:nrow(avesFCFL),size = ceiling(nrow(avesFCFL)* 0.3)),]"
"0",""
"0","###########"
"0","# Fit models in training data"
"0","###########"
"0",""
"0","# Fit lineal model"
"0","lm_FC_c1 <- lm(FemurCirc ~ FemurLen, data = avesFCFL.train)"
"0",""
"0","# Fit loglog model"
"0","loglog_FC_c1 <- lm(log(FemurCirc) ~ log(FemurLen), data = avesFCFL.train)"
"0",""
"0","# Multiple linear regression Clade 1"
"0","lmClade1_FC_c1 <- lm(FemurCirc ~ FemurLen + Clade.1, data = avesFCFL.train)"
"0",""
"0",""
"0","# Multiple loglog linear regression Clade 1"
"0","logClade1_FC_c1 <- lm(log(FemurCirc) ~ log(FemurLen) + Clade.1, data = avesFCFL.train)"
"0",""
"0",""
"0","# Multiple linear regression Clade 2"
"0","lmClade2_FC_c1 <- lm(FemurCirc ~ FemurLen + Clade.2, data = avesFCFL.train)"
"0",""
"0","# Multiple loglog linear regression Clade 2"
"0","logClade2_FC_c1 <- lm(log(FemurCirc) ~ log(FemurLen) + Clade.2, data = avesFCFL.train)"
"0",""
"0","# Poly model "
"0","poly2_FC_c1 <- lm(FemurCirc ~ poly(FemurLen,2), data = avesFCFL.train)"
"0",""
"0",""
"0","# Multiple Poly model Clade 1"
"0","poly2Clade1_FC_c1 <- lm(FemurCirc ~ poly(FemurLen,2) + Clade.1 , data = avesFCFL.train)"
"0",""
"0","# Multiple Poly model Clade 2"
"0","poly2Clade2_FC_c1 <- lm(FemurCirc ~ poly(FemurLen,2) + Clade.2, data = avesFCFL.train)"
"0",""
"0",""
"0","# Poly 3model "
"0","poly3_FC_c1 <- lm(FemurCirc ~ poly(FemurLen,3), data = avesFCFL.train)"
"0",""
"0","# Multiple Poly3 model Clade 1"
"0","poly3Clade1_FC_c1 <- lm(FemurCirc ~ poly(FemurLen,3) + Clade.1 , data = avesFCFL.train)"
"0",""
"0","# Multiple Poly3 model Clade 2"
"0","poly3Clade2_FC_c1 <- lm(FemurCirc ~ poly(FemurLen,3) + Clade.2, data = avesFCFL.train)"
"0",""
"0","fitvals_FC.train_c1 <- data.frame(FemurLen = avesFCFL.train$FemurLen, "
"0","                         trueFC = avesFCFL.train$FemurCirc,"
"0","                         FC_FL = lm_FC_c1$fitted.values, "
"0","                         logFC_logFL = exp(loglog_FC_c1$fitted.values),"
"0","                         FC_FL.Clade1 = lmClade1_FC_c1$fitted.values,"
"0","                         logFC_logFL.Clade1 = exp(logClade1_FC_c1$fitted.values),"
"0","                         FC_FL.Cl2 = lmClade2_FC_c1$fitted.values,"
"0","                         logFC_logFL.Clade2 = exp(logClade2_FC_c1$fitted.values),"
"0","                         FC_poly2FL = poly2_FC_c1$fitted.values,"
"0","                         FC_poly2FL.Clade1 = poly2Clade1_FC_c1$fitted.values,"
"0","                         FC_poly2FL.Clade2 = poly2Clade2_FC_c1$fitted.values,"
"0","                         FC_poly3FL = poly3_FC_c1$fitted.values,"
"0","                         FC_poly3FL.Clade1 = poly3Clade1_FC_c1$fitted.values,"
"0","                         FC_poly3FL.Clade2 = poly3Clade2_FC_c1$fitted.values)"
"0",""
"0",""
"0","fitvals_FC.long_c1 <- fitvals_FC.train_c1 %>% pivot_longer(-FemurLen, names_to = 'model', values_to = 'FemurCirc')"
"0",""
"0",""
"0","###########"
"0","# RRMSE in training data: Case 1"
"0","###########"
"0",""
"0","n <- length(avesFCFL.train$FemurLen)"
"0",""
"0",""
"0","lm_FC_RMSE.trainc1 <- ( sum((avesFCFL.train$FemurCirc - lm_FC_c1$fitted.values)^2)/n)"
"0","loglog_FC_RMSE.trainc1 <- ( sum((log(avesFCFL.train$FemurCirc) - loglog_FC_c1$fitted.values)^2)/n)"
"0","lmClade1_FC_RMSE.trainc1 <- ( sum((avesFCFL.train$FemurCirc - lmClade1_FC_c1$fitted.values)^2)/n)"
"0","logClade1_FC_RMSE.trainc1 <- ( sum((log(avesFCFL.train$FemurCirc) - logClade1_FC_c1$fitted.values)^2)/n)"
"0","poly2_FC_RMSE.trainc1 <- ( sum((avesFCFL.train$FemurCirc - poly2_FC_c1$fitted.values)^2)/n)"
"0","poly2Clade1_FC_RMSE.trainc1 <- ( sum((avesFCFL.train$FemurCirc - poly2Clade1_FC_c1$fitted.values)^2)/n)"
"0","poly3_FC_RMSE.trainc1 <- ( sum((avesFCFL.train$FemurCirc - poly3_FC_c1$fitted.values)^2)/n)"
"0","poly3Clade1_FC_RMSE.trainc1 <- ( sum((avesFCFL.train$FemurCirc - poly3Clade1_FC_c1$fitted.values)^2)/n)"
"0","lmClade2_FC_RMSE.trainc1 <- ( sum((avesFCFL.train$FemurCirc - lmClade2_FC_c1$fitted.values)^2)/n)"
"0","logClade2_FC_RMSE.trainc1 <- ( sum((log(avesFCFL.train$FemurCirc) - logClade2_FC_c1$fitted.values)^2)/n)"
"0","poly2Clade2_FC_RMSE.trainc1 <- ( sum((avesFCFL.train$FemurCirc - poly2Clade2_FC_c1$fitted.values)^2)/n)"
"0","poly3Clade2_FC_RMSE.trainc1 <- ( sum((avesFCFL.train$FemurCirc - poly3Clade2_FC_c1$fitted.values)^2)/n)"
"0",""
"0",""
"0",""
"0","RMSE.train_c1 <- data.frame(type = 'train', "
"0","                        lm_FC_c1 = lm_FC_RMSE.trainc1,"
"0","                       loglog_FC_c1 = loglog_FC_RMSE.trainc1,"
"0","                       lmClade1_FC_c1 = lmClade1_FC_RMSE.trainc1,"
"0","                       logClade1_FC_c1 = logClade1_FC_RMSE.trainc1,"
"0","                       poly2_FC_c1 = poly2_FC_RMSE.trainc1, "
"0","                       poly2Clade1_FC_c1 = poly2Clade1_FC_RMSE.trainc1,"
"0","                       poly3_FC_c1 = poly3_FC_RMSE.trainc1,"
"0","                       poly3Clade1_FC_c1 = poly3Clade1_FC_RMSE.trainc1,"
"0","                       lmClade2_FC_c1 = lmClade2_FC_RMSE.trainc1,"
"0","                       logClade2_FC_c1 = logClade2_FC_RMSE.trainc1, "
"0","                       poly2Clade2_FC_c1 = poly2Clade2_FC_RMSE.trainc1,"
"0","                       poly3Clade2_FC_c1 =  poly3Clade2_FC_RMSE.trainc1)"
"0",""
"0",""
"0","###########"
"0","# predicting  in test data"
"0","###########"
"0",""
"0",""
"0","lm_FC_c1.prd <- predict(lm_FC_c1, newdata = data.frame(FemurLen = avesFCFL.test$FemurLen))"
"0","loglog_FC_c1.prd <- predict(loglog_FC_c1, newdata = data.frame(FemurLen = avesFCFL.test$FemurLen))"
"0","lmClade1_FC_c1.prd <- predict(lmClade1_FC_c1, newdata = data.frame(FemurLen = avesFCFL.test$FemurLen,"
"0","                                                                   Clade.1=avesFCFL.test$Clade.1))"
"0","logClade1_FC_c1.prd <- predict(logClade1_FC_c1, newdata = data.frame(FemurLen = avesFCFL.test$FemurLen,"
"0","                                                                   Clade.1=avesFCFL.test$Clade.1))"
"0","poly2_FC_c1.prd <- predict(poly2_FC_c1, newdata = data.frame(FemurLen = avesFCFL.test$FemurLen))"
"0","poly2Clade1_FC_c1.prd <- predict(poly2Clade1_FC_c1, newdata = data.frame(FemurLen = avesFCFL.test$FemurLen,"
"0","                                                                   Clade.1=avesFCFL.test$Clade.1))"
"0","poly3_FC_c1.prd <- predict(poly3_FC_c1, newdata = data.frame(FemurLen = avesFCFL.test$FemurLen))"
"0","poly3Clade1_FC_c1.prd <- predict(poly3Clade1_FC_c1, newdata = data.frame(FemurLen = avesFCFL.test$FemurLen,"
"0","                                                                   Clade.1=avesFCFL.test$Clade.1))"
"0","lmClade2_FC_c1.prd <- predict(lmClade2_FC_c1, newdata = data.frame(FemurLen = avesFCFL.test$FemurLen,"
"0","                                                                   Clade.2=avesFCFL.test$Clade.2))"
"0","logClade2_FC_c1.prd <- predict(logClade2_FC_c1, newdata = data.frame(FemurLen = avesFCFL.test$FemurLen,"
"0","                                                                   Clade.2=avesFCFL.test$Clade.2))"
"0","poly2Clade2_FC_c1.prd <- predict(poly2Clade2_FC_c1, newdata = data.frame(FemurLen = avesFCFL.test$FemurLen,"
"0","                                                                   Clade.2=avesFCFL.test$Clade.2))"
"0","poly3Clade2_FC_c1.prd  <- predict(poly3Clade2_FC_c1, newdata = data.frame(FemurLen = avesFCFL.test$FemurLen,"
"0","                                                                   Clade.2=avesFCFL.test$Clade.2))"
"0",""
"0",""
"0",""
"0","###########"
"0","# RRMSE in predicting data set: Case 1"
"0","###########"
"0",""
"0","n <- length(avesFCFL.test$FemurLen)"
"0",""
"0","lm_FC_RMSE.testc1 <- ( sum((avesFCFL.test$FemurCirc - lm_FC_c1.prd)^2)/n)"
"0","loglog_FC_RMSE.testc1 <- ( sum((log(avesFCFL.test$FemurCirc) - loglog_FC_c1.prd)^2)/n)"
"0","lmClade1_FC_RMSE.testc1 <- ( sum((avesFCFL.test$FemurCirc - lmClade1_FC_c1.prd)^2)/n)"
"0","logClade1_FC_RMSE.testc1 <- ( sum((log(avesFCFL.test$FemurCirc) - logClade1_FC_c1.prd)^2)/n)"
"0","poly2_FC_RMSE.testc1 <- ( sum((avesFCFL.test$FemurCirc - poly2_FC_c1.prd)^2)/n)"
"0","poly2Clade1_FC_RMSE.testc1 <- ( sum((avesFCFL.test$FemurCirc - poly2Clade1_FC_c1.prd)^2)/n)"
"0","poly3_FC_RMSE.testc1 <- ( sum((avesFCFL.test$FemurCirc - poly3_FC_c1.prd)^2)/n)"
"0","poly3Clade1_FC_RMSE.testc1 <- ( sum((avesFCFL.test$FemurCirc - poly3Clade1_FC_c1.prd)^2)/n)"
"0","lmClade2_FC_RMSE.testc1 <- ( sum((avesFCFL.test$FemurCirc - lmClade2_FC_c1.prd)^2)/n)"
"0","logClade2_FC_RMSE.testc1 <- ( sum((log(avesFCFL.test$FemurCirc) - logClade2_FC_c1.prd)^2)/n)"
"0","poly2Clade2_FC_RMSE.testc1 <- ( sum((avesFCFL.test$FemurCirc - poly2Clade2_FC_c1.prd)^2)/n)"
"0","poly3Clade2_FC_RMSE.testc1 <- ( sum((avesFCFL.test$FemurCirc - poly3Clade2_FC_c1.prd)^2)/n)"
"0",""
"0",""
"0",""
"0","RMSE.test_c1 <- data.frame(type = 'test', "
"0","                      lm_FC_c1 = lm_FC_RMSE.testc1,"
"0","                       loglog_FC_c1 = loglog_FC_RMSE.testc1,"
"0","                       lmClade1_FC_c1 = lmClade1_FC_RMSE.testc1,"
"0","                       logClade1_FC_c1 = logClade1_FC_RMSE.testc1,"
"0","                       poly2_FC_c1 = poly2_FC_RMSE.testc1, "
"0","                       poly2Clade1_FC_c1 = poly2Clade1_FC_RMSE.testc1,"
"0","                       poly3_FC_c1 = poly3_FC_RMSE.testc1,"
"0","                       poly3Clade1_FC_c1 = poly3Clade1_FC_RMSE.testc1,"
"0","                       lmClade2_FC_c1 = lmClade2_FC_RMSE.testc1,"
"0","                       logClade2_FC_c1 = logClade2_FC_RMSE.testc1, "
"0","                       poly2Clade2_FC_c1 = poly2Clade2_FC_RMSE.testc1,"
"0","                       poly3Clade2_FC_c1 =  poly3Clade2_FC_RMSE.testc1)"
"0",""
"0",""
"0","RMSE_c1 <- rbind(RMSE.train_c1, RMSE.test_c1)"
"0",""
"0","#MSE "
"0",""
"0","RMSE.long_c1 <- RMSE_c1 %>% pivot_longer(-type, names_to = 'model', values_to = 'MSE')"
"0",""
"0",""
"0","#################################################### Cross Validation ##############################################"
"0",""
"0","###########"
"0","# Preliminar Analysis: Case 2: Split Cross validation k fold"
"0","###########"
"0",""
"0","avesFCFL.cv <- avesFCFL"
"0",""
"0","###########"
"0","# Fit models in training data"
"0","###########"
"0",""
"0",""
"0","train.control <- trainControl(method = ""repeatedcv"", "
"0","                              number = 10, repeats = 20)"
"0",""
"0","# Fit lineal model"
"0","lm_FC_c2 <- train(FemurCirc ~ FemurLen, data = avesFCFL.cv,method = ""lm"","
"0","               trControl = train.control)"
"0",""
"0","# Fit loglog model"
"0","loglog_FC_c2 <- train(log(FemurCirc) ~ log(FemurLen), data = avesFCFL.cv, method = ""lm"","
"0","               trControl = train.control)"
"0",""
"0","# Multiple linear regression Clade 1"
"0","lmClade1_FC_c2 <- train(FemurCirc ~ FemurLen + Clade.1, data = avesFCFL.cv, method = ""lm"","
"0","               trControl = train.control)"
"0",""
"0",""
"0","# Multiple loglog linear regression Clade 1"
"0","logClade1_FC_c2 <- train(log(FemurCirc) ~ log(FemurLen) + Clade.1, data = avesFCFL.cv, method = ""lm"","
"0","               trControl = train.control)"
"0",""
"0",""
"0","# Multiple linear regression Clade 2"
"0","lmClade2_FC_c2 <- train(FemurCirc ~ FemurLen + Clade.2, data = avesFCFL.cv, method = ""lm"","
"0","               trControl = train.control)"
"0",""
"0","# Multiple loglog linear regression Clade 2"
"0","logClade2_FC_c2 <- train(log(FemurCirc) ~ log(FemurLen) + Clade.2, data = avesFCFL.cv, method = ""lm"","
"0","               trControl = train.control)"
"0",""
"0","# Poly model "
"0","poly2_FC_c2 <- train(FemurCirc ~ poly(FemurLen,2), data = avesFCFL.cv, method = ""lm"","
"0","               trControl = train.control)"
"0",""
"0",""
"0","# Multiple Poly model Clade 1"
"0","poly2Clade1_FC_c2 <- train(FemurCirc ~ poly(FemurLen,2) + Clade.1 , data = avesFCFL.cv, method = ""lm"","
"0","               trControl = train.control)"
"0",""
"0","# Multiple Poly model Clade 2"
"0","poly2Clade2_FC_c2 <- train(FemurCirc ~ poly(FemurLen,2) + Clade.2, data = avesFCFL.cv, method = ""lm"","
"0","               trControl = train.control)"
"0",""
"0",""
"0","# Poly 3model "
"0","poly3_FC_c2 <- train(FemurCirc ~ poly(FemurLen,3), data = avesFCFL.cv, method = ""lm"","
"0","               trControl = train.control)"
"0",""
"0","# Multiple Poly3 model Clade 1"
"0","poly3Clade1_FC_c2 <- train(FemurCirc ~ poly(FemurLen,3) + Clade.1 , data = avesFCFL.cv, method = ""lm"","
"0","               trControl = train.control)"
"0",""
"0","# Multiple Poly3 model Clade 2"
"0","poly3Clade2_FC_c2 <- train(FemurCirc ~ poly(FemurLen,3) + Clade.2, data = avesFCFL.cv, method = ""lm"","
"0","               trControl = train.control)"
"0",""
"0",""
"0","fitvals_FC.cv_c2 <- data.frame(type = ""cv"","
"0","                         FC_FL = lm_FC_c2$results$RMSE, "
"0","                         logFC_logFL = exp(loglog_FC_c2$results$RMSE),"
"0","                         FC_FL.Clade1 = lmClade1_FC_c2$results$RMSE,"
"0","                         logFC_logFL.Clade1 = exp(logClade1_FC_c2$results$RMSE),"
"0","                         FC_FL.Cl2 = lmClade2_FC_c2$results$RMSE,"
"0","                         logFC_logFL.Clade2 = exp(logClade2_FC_c2$results$RMSE),"
"0","                         FC_poly2FL = poly2_FC_c2$results$RMSE,"
"0","                         FC_poly2FL.Clade1 = poly2Clade1_FC_c2$results$RMSE,"
"0","                         FC_poly2FL.Clade2 = poly2Clade2_FC_c2$results$RMSE,"
"0","                         FC_poly3FL = poly3_FC_c2$results$RMSE,"
"0","                         FC_poly3FL.Clade1 = poly3Clade1_FC_c2$results$RMSE,"
"0","                         FC_poly3FL.Clade2 = poly3Clade2_FC_c2$results$RMSE)"
"0",""
"0",""
"0","fitvals_FC.long_c2 <- fitvals_FC.cv_c2 %>% pivot_longer(-type, names_to = 'model', values_to = 'RMSE')"
"0",""
"0",""
"0",""
